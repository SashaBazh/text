Задача 18
1.	Спроектируйте базу данных Supply для автоматизации учета информации о поступлении товара в магазин.
Для каждого товара должна храниться информация: 
•	артикул товара (уникален, содержит только цифры);
•	название товара;
•	категория товара;
Кроме того, хранится информация обо всех поставках товаров. Каждая поставка товара сопровождается товарной накладной:
•	поставляемый товар;
•	номер накладной (уникален);
•	цена за единицу товара; 
•	количество товара;
•	дата поступления товара;

В СУБД MY SQL, используя команды определения данных создать базу данных.  Создать таблицы Товар и Продажа, для каждой таблицы определив первичные ключи. Определить в подчиненной таблице внешний ключ. Создать связь между таблицами с помощью внешнего ключа, обеспечив каскадное удаление и обновление данных. (+1)
2.	Используя команды манипулирования данными, добавить в созданные таблицы по пять записей, таких чтобы результаты нижеперечисленных запросов содержали не менее одной записи. (+1)
  
3.	Используя команды языка SQL, выполнить следующие действия:

1)	 Написать  запросы для получения следующей информации (результаты выполнения запросов не должны быть пустыми): Выведите название и категорию товаров, поступивших зимой текущего года. (+1)
2)	Написать хранимую процедуру, вычисляющую среднюю цену поставленных товаров, заданного артикула. Артикул товара передается в процедуру в качестве параметра. (+2)
3)	Продемонстрировать вызов процедуры и проссмотр результата ее работы. (+1)


-- 1. Создание БД и таблиц
CREATE DATABASE IF NOT EXISTS Supply;
USE Supply;

CREATE TABLE IF NOT EXISTS Товар (
    артикул INT PRIMARY KEY CHECK (артикул REGEXP '^[0-9]+$'),
    название VARCHAR(255),
    категория VARCHAR(100)
);

CREATE TABLE IF NOT EXISTS Поставка (
    номер_накладной INT PRIMARY KEY,
    артикул_товара INT,
    цена DECIMAL(10,2),
    количество INT,
    дата_поступления DATE,
    FOREIGN KEY (артикул_товара) REFERENCES Товар(артикул)
    ON DELETE CASCADE ON UPDATE CASCADE
);

-- 2. Вставка данных
INSERT INTO Товар VALUES 
(6001, 'Принтер', 'Офисная техника'),
(6002, 'Лампа', 'Освещение');

INSERT INTO Поставка VALUES 
(8001, 6001, 15000.00, 5, '2023-12-10'),
(8002, 6002, 2000.50, 10, '2023-11-25');

-- 3. SQL-запросы
-- 1) Товары, поступившие зимой
SELECT название, категория 
FROM Товар 
WHERE артикул IN (
    SELECT артикул_товара 
    FROM Поставка 
    WHERE MONTH(дата_поступления) IN (12, 1, 2)
);

-- 2) Хранимая процедура
DELIMITER $$
CREATE PROCEDURE СредняяЦена(IN товар_артикул INT)
BEGIN
    SELECT AVG(цена) AS средняя_цена 
    FROM Поставка 
    WHERE артикул_товара = товар_артикул;
END $$
DELIMITER ;

-- 3) Вызов процедуры
CALL СредняяЦена(6001);
