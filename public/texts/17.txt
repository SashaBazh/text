-- 1. Создание БД и таблиц
CREATE DATABASE IF NOT EXISTS Exam;
USE Exam;

CREATE TABLE IF NOT EXISTS Преподаватель (
    табельный_номер INT PRIMARY KEY CHECK (табельный_номер REGEXP '^[0-9]+$'),
    ФИО VARCHAR(255),
    дата_приема DATE,
    категория ENUM('первая', 'вторая', 'высшая')
);

CREATE TABLE IF NOT EXISTS Экзамен (
    номер_направления INT PRIMARY KEY,
    табельный_номер_преподавателя INT,
    ФИО_учащегося VARCHAR(255),
    предмет VARCHAR(100),
    дата_сдачи DATE,
    оценка INT,
    FOREIGN KEY (табельный_номер_преподавателя) REFERENCES Преподаватель(табельный_номер)
    ON DELETE CASCADE ON UPDATE CASCADE
);

-- 2. Вставка данных
INSERT INTO Преподаватель VALUES 
(301, 'Васильев К.К.', '2017-08-12', 'высшая'),
(302, 'Николаева М.М.', '2020-04-05', 'первая');

INSERT INTO Экзамен VALUES 
(5001, 301, 'Студент9', 'История', '2023-03-15', 4),
(5002, 301, 'Студент10', 'Литература', '2023-04-20', 5);

-- 3. SQL-запросы
-- 1) Преподаватели, принимавшие экзамены весной
SELECT ФИО, дата_приема 
FROM Преподаватель 
WHERE табельный_номер IN (
    SELECT табельный_номер_преподавателя 
    FROM Экзамен 
    WHERE MONTH(дата_сдачи) BETWEEN 3 AND 5
);

-- 2) Хранимая процедура
DELIMITER $$
CREATE PROCEDURE УченикиПреподавателя(IN преподаватель_id INT)
BEGIN
    SELECT COUNT(DISTINCT ФИО_учащегося) AS количество_учеников 
    FROM Экзамен 
    WHERE табельный_номер_преподавателя = преподаватель_id;
END $$
DELIMITER ;

-- 3) Вызов процедуры
CALL УченикиПреподавателя(301);
