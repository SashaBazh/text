-- 1. Создание БД и таблиц
CREATE DATABASE IF NOT EXISTS Sale;
USE Sale;

CREATE TABLE IF NOT EXISTS Товар (
    артикул INT PRIMARY KEY CHECK (артикул REGEXP '^[0-9]+$'),
    название VARCHAR(255) NOT NULL,
    категория VARCHAR(100),
    количество_на_складе INT
);

CREATE TABLE IF NOT EXISTS Продажа (
    номер_чека INT PRIMARY KEY,
    артикул_товара INT,
    количество INT,
    дата_продажи DATE,
    FOREIGN KEY (артикул_товара) REFERENCES Товар(артикул)
    ON DELETE CASCADE ON UPDATE CASCADE
);

-- 2. Вставка данных (пример)
INSERT INTO Товар VALUES 
(1001, 'Ноутбук', 'Электроника', 10),
(1002, 'Стул', 'Мебель', 20),
(1003, 'Книга', 'Канцелярия', 50),
(1004, 'Телефон', 'Электроника', 15),
(1005, 'Стол', 'Мебель', 8);

INSERT INTO Продажа VALUES 
(2001, 1001, 2, CURDATE()),
(2002, 1002, 5, '2023-10-15'),
(2003, 1003, 10, CURDATE()),
(2004, 1004, 1, '2023-09-20'),
(2005, 1005, 3, CURDATE());

-- 3. SQL-запросы
-- 1) Представление Товары1
CREATE VIEW Товары1 AS
SELECT t.артикул, t.название, SUM(p.количество) AS проданное_количество
FROM Товар t
LEFT JOIN Продажа p ON t.артикул = p.артикул_товара
GROUP BY t.артикул;

-- 2) Представление Продажи1
CREATE VIEW Продажи1 AS
SELECT t.название, p.дата_продажи, p.количество
FROM Продажа p
JOIN Товар t ON p.артикул_товара = t.артикул;

-- 3) Общее количество за сегодня
SELECT SUM(количество) AS сегодняшние_продажи 
FROM Продажи1 
WHERE дата_продажи = CURDATE();

-- 4) Товары с максимальными продажами
SELECT * FROM Товары1 
WHERE проданное_количество = (SELECT MAX(проданное_количество) FROM Товары1);
