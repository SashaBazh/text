Задача 22
1.	Спроектируйте базу данных University для автоматизации учета информации о филиалах учебного заведения.  
Учебное заведение имеет несколько филиалов. Для каждого филиала должна храниться следующая информация: 
•	номер филиала (уникален, содержит только цифры);
•	адрес;
•	рейтинг;
•	дата последнего подтверждения государственной аккредитации. 
В учебном заведении хранится информация обо всех группах каждого из филиалов:
•	номер филиала, к которому относится группа;
•	Номер группы (уникален);
•	курс;
•	количество учащихся в группе.  
В СУБД MS SQL SERVER, используя команды определения данных создать базу данных. Создать таблицы Филиал и Группа, для каждой таблицы определив первичные ключи. Определить в подчиненной таблице внешний ключ. Создать связь между таблицами с помощью внешнего ключа, обеспечив каскадное удаление и обновление данных. (+1)
2.	Используя команды манипулирования данными, добавить в созданные таблицы по пять записей, таких чтобы результаты нижеперечисленных запросов содержали не менее одной записи. (+1)
  
3.	Используя команды языка SQL, выполнить следующие действия:
1)	Написать триггер, который увеличивает рейтинг филиала на 1, если количество групп в данном филиале стало больше 3.  (+2)
2)	Продемонстрировать работу триггера, добавив информацию о группе. (+1) 
3)	Написать запрос для получения следующей информации (результаты выполнения запроса не должны быть пустыми): Выведите Номера и Адреса филиалов, подтвердивших Государственную аккредитацию в текущем году. (+1)

-- 1. Создание БД и таблиц
CREATE DATABASE University;
GO
USE University;
GO
CREATE TABLE Филиал (
    номер INT PRIMARY KEY CHECK (номер LIKE '[0-9]%'),
    адрес VARCHAR(255),
    рейтинг INT DEFAULT 0,
    дата_аккредитации DATE
);
GO
CREATE TABLE Группа (
    номер_группы INT PRIMARY KEY,
    номер_филиала INT,
    курс INT,
    количество_учащихся INT,
    FOREIGN KEY (номер_филиала) REFERENCES Филиал(номер)
    ON DELETE CASCADE ON UPDATE CASCADE
);
GO

-- 2. Вставка данных
INSERT INTO Филиал (номер, адрес, рейтинг, дата_аккредитации) VALUES (1, 'ул. Ленина, 1', 2, '2023-05-10'), (2, 'пр. Мира, 5', 3, '2022-11-15'), (3, 'ул. Гагарина, 20', 1, '2023-10-20'), (4, 'ул. Пушкина, 7', 5, '2024-01-05'), (5, 'пр. Ленина, 15', 4, '2023-09-22');
INSERT INTO Группа (номер_группы, номер_филиала, курс, количество_учащихся) VALUES (101, 1, 3, 25), (102, 1, 2, 30), (103, 1, 1, 22), (201, 2, 1, 20), (202, 2, 4, 28), (301, 3, 3, 22), (401, 4, 2, 25), (402, 4, 1, 30), (501, 5, 3, 18);

-- 3. SQL-запросы
-- 1) Триггер для увеличения рейтинга
GO
CREATE TRIGGER IncreaseRating
ON Группа
AFTER INSERT
AS
BEGIN
    IF (SELECT COUNT(*) FROM Группа WHERE номер_филиала = (SELECT номер_филиала FROM inserted)) > 3
    BEGIN
        UPDATE Филиал SET рейтинг = рейтинг + 1 WHERE номер = (SELECT номер_филиала FROM inserted);
    END
END;
GO

-- 2) Демонстрация работы триггера
INSERT INTO Группа (номер_группы, номер_филиала, курс, количество_учащихся) VALUES (104, 1, 1, 20);
SELECT * FROM Филиал WHERE номер = 1;

-- 3) Филиалы с аккредитацией в текущем году
SELECT номер, адрес FROM Филиал WHERE YEAR(дата_аккредитации) = YEAR(GETDATE());